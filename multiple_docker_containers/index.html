<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/API-Playbook/blog/rss.xml" title="Hackney API Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/API-Playbook/blog/atom.xml" title="Hackney API Playbook Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney API Playbook" href="/API-Playbook/opensearch.xml"><title data-react-helmet="true">Composing Your Application With Multiple Docker Containers | Hackney API Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Composing Your Application With Multiple Docker Containers | Hackney API Playbook"><meta data-react-helmet="true" name="description" content="Purpose"><meta data-react-helmet="true" property="og:description" content="Purpose"><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io/API-Playbook/API-Playbook/multiple_docker_containers"><link data-react-helmet="true" rel="shortcut icon" href="/API-Playbook/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io/API-Playbook/API-Playbook/multiple_docker_containers"><link rel="stylesheet" href="/API-Playbook/styles.2116970b.css">
<link rel="stylesheet" href="/API-Playbook/main.4a16e2e4.css">
<link rel="preload" href="/API-Playbook/styles.023827bd.js" as="script">
<link rel="preload" href="/API-Playbook/runtime~main.a6b0fe65.js" as="script">
<link rel="preload" href="/API-Playbook/main.9ec32a93.js" as="script">
<link rel="preload" href="/API-Playbook/1.70185c52.js" as="script">
<link rel="preload" href="/API-Playbook/2.2c6880ad.js" as="script">
<link rel="preload" href="/API-Playbook/67.954ae7f5.js" as="script">
<link rel="preload" href="/API-Playbook/70.9338f9b9.js" as="script">
<link rel="preload" href="/API-Playbook/935f2afb.abb5d9a7.js" as="script">
<link rel="preload" href="/API-Playbook/17896441.c517a8c6.js" as="script">
<link rel="preload" href="/API-Playbook/294d5e67.a2a14016.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/API-Playbook/notes">Release Notes</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Home</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_standards">API Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/platform_api_vs_service_api">Platform API vs Service API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/documentation">API Documentation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development Process</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Designing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_implementation_guidelines">API Implementation Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_design_principles">API Design Principles</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Implementation Guidelines</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/general_guidelines">General Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/security">Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/compatibility">Compatibility</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/deprecation">Deprecation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/naming_conventions">Naming Conventions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/http">HTTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/resources">Resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/pagination">Pagination</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/data-formats">Data Formats</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/operation">Operation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/references">References</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/error_codes">Error Codes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">API Practices and Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/linting">Linting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/static_code_analysis">Static Code Analysis</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">DevOps Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/branching_strategies">Branching Strategies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/deployment_pipeline">Deployment Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/infrastructure">Infrastucture as Code</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">API Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/preferred_tech_stack">Preferred Tech Stack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_boilerplate">API Boilerplate - Base API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/clean_architecture">Clean Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/serverless_lambda">Serverless Lambda Framework</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/entity_framework">Entity Framework Core</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Listeners</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/listener_tech_stack">Listener Tech Stack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/listener_boilerplate">Listener Boilerplate - Base Listener</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">How to build an API</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/tdd">Good TDD Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/unit_testing">Writing Unit Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/mock_unit_tests">Isolating Unit Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/integration_tests">How to write integration tests</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Deploying your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/aws_ecs">AWS / ECS with Fargate and when to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/lambda_best_practices">Lambda Functions Use and Good Practice</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/API-Playbook/multiple_docker_containers">Composing Your Application With Multiple Docker Containers</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Monitoring</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/alerting">Alerting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/application_logging">Application Logging Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/centralised_logging">Centralised Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/performance_monitoring">AWS Lambda insights for Performance Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/uptime_monitoring">Centralised Uptime Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/x_ray">Request Tracing with AWS XRay</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Securing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_keys">API Keys</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/lambda_authoriser">Lambda Authoriser</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Production Checklist</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/debugging_apis">Debugging APIs in Production</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/production_testing">Production Testing Checklist</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Other Useful Information</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/rds_access">Access to RDS in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/ec2_access">Access to EC2 in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/postgresql">Creating users in PostgreSQL</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Data Migration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/data_migration">Setting Up AWS DMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/pipeline_implementation">Pipeline Implementation</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/API-Playbook/first_end_point">End to End Training</a></li><li class="menu__list-item"><a class="menu__link" href="/API-Playbook/developer_hub">Developer API Hub</a></li><li class="menu__list-item"><a class="menu__link" href="/API-Playbook/contact_us">Contact The Hackney API Team</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Composing Your Application With Multiple Docker Containers</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="purpose"></a>Purpose<a class="hash-link" href="#purpose" title="Direct link to heading">#</a></h2><p>The purpose of this document is to outline how and when best to orchestrate the creation and linking of multiple containers using docker-compose</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>You may already be aware that Docker is used extensively within HackIt when building APIs and services. You may also already know how we would go about spinning up a container for an application.</p><p>For many of our use cases, spinning up the application in a container by itself is not sufficient. The application may require access to other external resources such as a database or an API.</p><p>In order to do this there needs to be a way to spin up multiple containers and make them accessible to each other.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="video-tutorial"></a>Video Tutorial<a class="hash-link" href="#video-tutorial" title="Direct link to heading">#</a></h2><figure class="video-container"><iframe width="100%" src="https://www.youtube.com/embed/Kz-tTwSePoI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="composing-your-application"></a>Composing Your Application<a class="hash-link" href="#composing-your-application" title="Direct link to heading">#</a></h2><p>When you have an application in a docker container you can simply run the command <code>docker run [your-application]</code> to get it up and running.</p><p>However, by default this container wonâ€™t be all you need to test an application.  It is likely that there would be additional resources, for example a database, that your application would need access to. If you have a database image available you can spin this up and link it to your application using docker-compose.</p><p>In your container project you will need the <code>Dockerfile</code> for each container in your project. You will also need to have a <code>docker-compose.yml</code> file in your project where you will define all of the services that are required for your application.</p><p>An example docker-compose file taken from our BaseAPI looks like the following:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;3.2&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">base-api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> base</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">api</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> BaseApi/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">dockerfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ./Dockerfile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> 3000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">3000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> CONNECTION_STRING=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">database connection string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">links</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> dev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">dev-database</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">env_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> database.env</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> postgres</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ./database</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/docker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">entrypoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">initdb.d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">base-api-test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> base</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> .</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">dockerfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> BaseApi.Tests/Dockerfile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> DB_HOST=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">database url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> DB_PORT=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">database port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> DB_USERNAME=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">database username</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> DB_PASSWORD=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">database password</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> DB_DATABASE=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">database name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">links</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">test-database</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">build</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> .</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">dockerfile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> database/Dockerfile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">mapped port eg 5444</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">container port eg 5432</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">env_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> database.env</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The following is a breakdown of the various aspects of the base api docker-compose file (you can visit this link for all of the available configuration items for version 3 of docker-compose):</p><ul><li><p><strong> Version: </strong>  The version of the docker-compose format being used.</p></li><li><p><strong> Services: </strong> These are the various containerised components of the application.</p><ul><li>For example <code>base-api</code> is the section that describes the container that is created for the application itself while <code>dev-database</code> is the section that describes the container where the database will run.  </li></ul></li><li><p><strong> Image: </strong>  The name that Docker will give to the image when it is built (this could alternatively be the tag of the image if a build step is configured).</p></li><li><p><strong> Build: </strong> This provides the source  and context for the configuration items Docker needs to build the application image.</p></li><li><p><strong> Environment: </strong>  Here you can specify any environment variables required for your application to run including database connection information.</p><ul><li>This can also be supplied using environment variables specified in the env_file section.</li><li>It is strongly advised not to include environment variables within the docker-compose file itself outside of your development environment.</li><li>Instead, you can instruct Docker to get environment variables from the local environment where the container is being run.</li><li>To supply a connection string from your local environment the following configuration can be used:<div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> CONNECTION_STRING=$LOCAL_CONNECTION_STRING</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li>This will instruct Docker to look at your local environment for a  <code>LOCAL_CONNECTION_STRING</code> variable and supply that to the <code>CONNECTION_STRING</code> variable for the application.</li></ul></li><li><p><strong> Ports: </strong> If you need to expose any ports outside the containerised environment you can specify them here with the container port being the port the application actually listens on in the container and the mapped port being the port you will use in your local environment.</p></li><li><p><strong> Links: </strong>  Any related service that the main application would connect to can be spun up in parallel using these links.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="running-your-composition"></a>Running Your Composition<a class="hash-link" href="#running-your-composition" title="Direct link to heading">#</a></h2><p>You can spin up any individual service directly by calling <code>docker-compose up [name of service]</code>.</p><p>If the service is linked to another service via the <code>links:</code> section the linked service will also be spun up.</p><p>For example when calling <code>docker-compose up base-api</code>, as this service has a link to the dev-database, the dev-database will also be spun up in a container along with the base api application. </p><p>If you need to manually supply environment variables when running a composition and do not want to add them to your system environment they can be prepended to the docker-compose command, for example:</p><p><code>CONNECTION_STRING=[a connection string] docker-compose up base-api</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cleaning-up"></a>Cleaning Up<a class="hash-link" href="#cleaning-up" title="Direct link to heading">#</a></h2><p>It is important to periodically clean up your docker image cache using <code>docker system prune</code> or by clearing down unused images from the Docker dashboard.</p><p>This will ensure that your computer doesnâ€™t grind to a halt from lack of resources.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/API-Playbook/edit/master/docs/multiple_docker_containers.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/API-Playbook/lambda_best_practices"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Lambda Functions Use and Good Practice</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/API-Playbook/alerting"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Alerting Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#purpose" class="table-of-contents__link">Purpose</a></li><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#video-tutorial" class="table-of-contents__link">Video Tutorial</a></li><li><a href="#composing-your-application" class="table-of-contents__link">Composing Your Application</a></li><li><a href="#running-your-composition" class="table-of-contents__link">Running Your Composition</a></li><li><a href="#cleaning-up" class="table-of-contents__link">Cleaning Up</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/API-Playbook/styles.023827bd.js"></script>
<script src="/API-Playbook/runtime~main.a6b0fe65.js"></script>
<script src="/API-Playbook/main.9ec32a93.js"></script>
<script src="/API-Playbook/1.70185c52.js"></script>
<script src="/API-Playbook/2.2c6880ad.js"></script>
<script src="/API-Playbook/67.954ae7f5.js"></script>
<script src="/API-Playbook/70.9338f9b9.js"></script>
<script src="/API-Playbook/935f2afb.abb5d9a7.js"></script>
<script src="/API-Playbook/17896441.c517a8c6.js"></script>
<script src="/API-Playbook/294d5e67.a2a14016.js"></script>
</body>
</html>