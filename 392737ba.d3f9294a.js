(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{137:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),b=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=b(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=b(n),d=r,m=u["".concat(i,".").concat(d)]||u[d]||p[d]||o;return n?a.a.createElement(m,s(s({ref:t},l),{},{components:n})):a.a.createElement(m,s({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},207:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/debugging_apis-7938c5ae9bd31993e6d6a7a74d91d88d.png"},208:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/debugging_apis2-3fd43a4bf7fa25db506c5f2897f62e8c.png"},209:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/aws-03cf2a4e93eb16fe56bb4e1f60556e23.png"},86:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return b}));var r=n(3),a=n(7),o=(n(0),n(137)),i={id:"debugging_apis",title:"Debugging APIs in Production"},s={unversionedId:"debugging_apis",id:"debugging_apis",isDocsHomePage:!1,title:"Debugging APIs in Production",description:"Deployment",source:"@site/docs/debugging_apis.md",slug:"/debugging_apis",permalink:"/API-Playbook/debugging_apis",editUrl:"https://github.com/LBHackney-IT/API-Playbook/edit/master/docs/debugging_apis.md",version:"current",sidebar:"docs",previous:{title:"Lambda Authoriser",permalink:"/API-Playbook/lambda_authoriser"},next:{title:"Production Testing Checklist",permalink:"/API-Playbook/production_testing"}},c=[{value:"Deployment",id:"deployment",children:[]},{value:"Naming Conventions",id:"naming-conventions",children:[]},{value:"Responses",id:"responses",children:[]},{value:"Configuration and security",id:"configuration-and-security",children:[]},{value:"Errors",id:"errors",children:[]}],l={toc:c};function b(e){var t=e.components,i=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,i,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"deployment"},"Deployment"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Once your PR has been merged into master branch, head to the correct view in CircleCI - this is often easiest via clicking the check (or cross) symbol next to your merged PR in the GitHub repo\u2019s list of master branch commits - use the \u201cDetails\u201d links to go to the relevant CircleCI view:")),Object(o.b)("p",null,Object(o.b)("img",{alt:"GitHub CircleCI view",src:n(207).default})),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Once in CircleCI, make sure you\u2019re viewing the entire workflow for the build by checking the submenu on the left, and making sure the view URL includes workflows in its path"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"i.e. ",Object(o.b)("a",{parentName:"li",href:"https://app.circleci.com/pipelines/github/LBHackney-IT/person-api"},"https://app.circleci.com/pipelines/github/LBHackney-IT/person-api")))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"By navigating to the correct workflow, you can monitor the deployment of the application and manually permit the \u201cDeploy to Staging\u201d and \u201cDeploy to Production\u201d jobs if the prerequisite jobs (e.g. automated test runs, Terraform apply commands) succeed - or, if any jobs fail, you can click through to the job to debug the issue(s)"))),Object(o.b)("p",null,Object(o.b)("img",{alt:"Manually permit Circle CI deployments",src:n(208).default})),Object(o.b)("h2",{id:"naming-conventions"},"Naming Conventions"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"To review the endpoint URLs, check the controller(s) within your API project\u2019s codebase for route statements like:")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-dotnet"},'[Route("api/v1/persons")]\n')),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},"You\u2019ll also want to check any expected query parameters, which you should find in one or more files with Param in the filename (e.g. ",Object(o.b)("inlineCode",{parentName:"li"},"ResidentQueryParam.cs"),")"),Object(o.b)("li",{parentName:"ol"},"If any of these route statements or query parameters seem incorrect in their names, including the casing, refer to the relevant Swagger documentation for the API and update the codebase (or the Swagger doc) as required."),Object(o.b)("li",{parentName:"ol"},"If any route statements have been updated, be sure to double-check that they work and provide the expected responses, once the changes have been deployed to production, using the steps detailed in the \u2018Responses\u2019 section of this document"),Object(o.b)("li",{parentName:"ol"},"There are also naming conventions to follow API Playbook link for responses")),Object(o.b)("h2",{id:"responses"},"Responses"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To test the API\u2019s endpoints:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Visit the API Gateway dashboard within the correct region (e.g. ",Object(o.b)("a",{parentName:"li",href:"https://eu-west-2.console.aws.amazon.com/apigateway/main/apis"},"https://eu-west-2.console.aws.amazon.com/apigateway/main/apis"),")"),Object(o.b)("li",{parentName:"ul"},"Select the API you\u2019d like to test"),Object(o.b)("li",{parentName:"ul"},"Click the \u201cAny\u201d resource option and then the \u201cTest\u201d button:\n",Object(o.b)("img",{alt:"Testing endpoints in AWS",src:n(209).default})),Object(o.b)("li",{parentName:"ul"},"From the next view, you can choose a request method (such as GET), enter the path, set \u201cstage variables\u201d (like environment variables) and any request parameters, and then scroll down to click the \u201cTest\u201d button to see what the API\u2019s response to your request is"),Object(o.b)("li",{parentName:"ul"},"If the response is an error, you should be able to dig into the stack trace shown to begin debugging"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Make test requests of each of the API\u2019s endpoints, looking for potential issues with:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Response structures"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Do they match what you expect/the Swagger doc?"),Object(o.b)("li",{parentName:"ul"},"Are there any unexpected duplications?"),Object(o.b)("li",{parentName:"ul"},"Have enums been transformed correctly into strings?"),Object(o.b)("li",{parentName:"ul"},"Do all possible combinations of search parameters work as expected?"),Object(o.b)("li",{parentName:"ul"},"Do all possible variations of the limit and cursor parameters work as expected?"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Response times"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Are there requests that might take longer than the default lambda timeout of 6s to complete, e.g. searching all records with a high limit parameter?"),Object(o.b)("li",{parentName:"ul"},"Try to identify what kind of requests might trigger one or more long-running database queries - and see below for instructions for enabling slow query logging on any RDS database instances")))))),Object(o.b)("h2",{id:"configuration-and-security"},"Configuration and security"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Make sure slow query logging is enabled on any relevant RDS database instances by ","[steps to check or add to Terraform config?]"),Object(o.b)("li",{parentName:"ol"},"See the ",Object(o.b)("a",{parentName:"li",href:"/production_testing"},"Production Testing Checklist")," to complete this section!")),Object(o.b)("h2",{id:"errors"},"Errors"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"See the ",Object(o.b)("a",{parentName:"li",href:"/production_testing"},"Production Testing Checklist")," to complete this section!")))}b.isMDXComponent=!0}}]);