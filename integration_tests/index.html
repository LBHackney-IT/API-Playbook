<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/API-Playbook/blog/rss.xml" title="Hackney API Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/API-Playbook/blog/atom.xml" title="Hackney API Playbook Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney API Playbook" href="/API-Playbook/opensearch.xml"><title data-react-helmet="true">How to write integration tests | Hackney API Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How to write integration tests | Hackney API Playbook"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io/API-Playbook/API-Playbook/integration_tests"><link data-react-helmet="true" rel="shortcut icon" href="/API-Playbook/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io/API-Playbook/API-Playbook/integration_tests"><link rel="stylesheet" href="/API-Playbook/styles.2116970b.css">
<link rel="stylesheet" href="/API-Playbook/main.4a16e2e4.css">
<link rel="preload" href="/API-Playbook/styles.95e5aed4.js" as="script">
<link rel="preload" href="/API-Playbook/runtime~main.1c0c8783.js" as="script">
<link rel="preload" href="/API-Playbook/main.f4f132b0.js" as="script">
<link rel="preload" href="/API-Playbook/1.df898764.js" as="script">
<link rel="preload" href="/API-Playbook/2.94161a26.js" as="script">
<link rel="preload" href="/API-Playbook/71.75b0a699.js" as="script">
<link rel="preload" href="/API-Playbook/74.c8b6e964.js" as="script">
<link rel="preload" href="/API-Playbook/935f2afb.2614505f.js" as="script">
<link rel="preload" href="/API-Playbook/17896441.1e3aea75.js" as="script">
<link rel="preload" href="/API-Playbook/33c4419d.e6ccc942.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/API-Playbook/notes">Release Notes</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Home</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_standards">API Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/platform_api_vs_service_api">Platform API vs Service API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/documentation">API Documentation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Development Lifecycle</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Designing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_implementation_guidelines">API Implementation Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_design_principles">API Design Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/error_codes">Error Codes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Implementation Guidelines</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/general_guidelines">General Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/security">Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/compatibility">Compatibility</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/deprecation">Deprecation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/naming_conventions">Naming Conventions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/http">HTTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/resources">Resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/pagination">Pagination</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/data-formats">Data Formats</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/operation">Operation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/references">References</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Development Process</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">API Practices and Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/linting">Linting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/static_code_analysis">Static Code Analysis</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">DevOps Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/branching_strategies">Branching Strategies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/deployment_pipeline">Deployment Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/infrastructure">Infrastucture as Code</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">API Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/preferred_tech_stack">Preferred Tech Stack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_boilerplate">API Boilerplate - Base API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/clean_architecture">Clean Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/serverless_lambda">Serverless Lambda Framework</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/entity_framework">Entity Framework Core</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Listeners</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/listener_tech_stack">Listener Tech Stack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/listener_boilerplate">Listener Boilerplate - Base Listener</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">How to build an API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/tdd">Good TDD Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/unit_testing">Writing Unit Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/mock_unit_tests">Isolating Unit Tests</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/API-Playbook/integration_tests">How to write integration tests</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Deploying your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/aws_ecs">AWS / ECS with Fargate and when to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/lambda_best_practices">Lambda Functions Use and Good Practice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/multiple_docker_containers">Composing Your Application With Multiple Docker Containers</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Monitoring</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/alerting">Alerting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/application_logging">Application Logging Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/centralised_logging">Centralised Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/performance_monitoring">AWS Lambda insights for Performance Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/uptime_monitoring">Centralised Uptime Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/x_ray">Request Tracing with AWS XRay</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Securing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_keys">API Keys</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/lambda_authoriser">Lambda Authoriser</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Event Driven Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/eda">Event Driven Architecture</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Production Checklist</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/debugging_apis">Debugging APIs in Production</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/production_testing">Production Testing Checklist</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Data Migration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/data_migration">Setting Up AWS DMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/pipeline_implementation">Pipeline Implementation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Other Useful Information</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/rds_access">Access to RDS in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/ec2_access">Access to EC2 in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/postgresql">Creating users in PostgreSQL</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">End to End Training</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/first_end_point_postgres">Postgres End to End Training</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/first_end_point_dynamo">DynamoDB End to End Training</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/API-Playbook/developer_hub">Developer API Hub</a></li><li class="menu__list-item"><a class="menu__link" href="/API-Playbook/FAQs">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" href="/API-Playbook/contact_us">Contact The Hackney API Team</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">How to write integration tests</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>When creating a new endpoint or adding new functionality to an API it&#x27;s good practice to start by writing an integration test outlining the functionality you are hoping to achieve. You can then write unit tests when you touch the individual classes you will be working on. Integration tests give you confidence that all your classes work together and that the full feature you have made is working correctly. These tests are slightly different depending on which database type is being employed: Postgres of DynamoDb.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="video-tutorial"></a>Video Tutorial<a class="hash-link" href="#video-tutorial" title="Direct link to heading">#</a></h3><p><strong> Start by having a look at our E2E Tests overview: </strong></p><figure class="video-container"><iframe width="100%" src="https://www.youtube.com/embed/6QHeDl3KC7o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="postgres"></a>Postgres<a class="hash-link" href="#postgres" title="Direct link to heading">#</a></h2><p>PostgreSQL is an object-relational database system that uses SQL language along with many other features to securely store and scale all data workloads including the most complicated ones.</p><p>To write Integration tests, inherit the IntegrationTest class for some useful test setup.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dotnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class ExampleTest : IntegrationTests&lt;Startup&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  //... your tests here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will set up a web application factory so that you can make calls to endpoints, for example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dotnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var uri = new Uri($&quot;api/v1/residents/{personId}&quot;, UriKind. Relative);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var response = Client.GetAsync(uri);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It will also set up a database connection and register it in a mock startup class. You can also use this connection in the test setup if you need to add anything to the database to test against.</p><p>An example of an integration test for a GET endpoint would be to add entities to the database and then assert they get returned in the response from the endpoint. Here is a simplified example of this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dotnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var person = new DatabaseEntity { Id = 1, Name = &quot;Henry&quot; };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DatabaseContext.DatabaseEntities.Add(person);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">DatabaseContext.SaveChanges ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var response = Client.GetAsync( new Uri($&quot;api/v1/residents&quot;, UriKind.Relative));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var expectedJsonResponse = &quot;{ &quot;residents&quot;: [{ &quot;id&quot;: 1, &quot;name&quot;: &quot;Henry&quot; }] }&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">response.Result.Content.Should().Be(expectedJsonResponse);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dynamodb"></a>DynamoDb<a class="hash-link" href="#dynamodb" title="Direct link to heading">#</a></h2><p>DynamoDB is a NoSQL database service that provides fast and foreseeable performance with minimal scalability. Amazon DynamoDB removes the burden of operating and scaling distributed database</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="database-connection"></a>Database connection<a class="hash-link" href="#database-connection" title="Direct link to heading">#</a></h3><p>The DynamoDbIntegrationTests.OneTimeSetUp() method is what controls which database instance is used. It ensures that some environment variables that are later used in connecting to the DynamoDb instance are set.</p><table><thead><tr><th>Env Var Name</th><th>Description</th><th>Default Value</th></tr></thead><tbody><tr><td><strong>DynamoDb_LocalMode</strong></td><td>Indicates whether or not to use a local DynamoDb instance.<br>If false it is assumed that the current context and credentials of the running code have been given access to a DynamoDb instance through an IAM policy.</td><td>true</td></tr><tr><td><strong>DynamoDb_LocalServiceUrl</strong></td><td>The Uri to the local DynamoDb instance.<br>Only used if the LocalMode is set to true.</td><td>http://localhost:8000</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="database-setup"></a>Database setup<a class="hash-link" href="#database-setup" title="Direct link to heading">#</a></h3><p><strong> IMPORTANT: </strong> In order to ensure that the database instance used for the tests has all of the necessary tables created, update the DynamoDbIntegrationTests._tables collection with the necessary details. <strong> The details specifed here must match those that are set up by terraform, and those specified on any database entities.</strong></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="writing-tests"></a>Writing tests<a class="hash-link" href="#writing-tests" title="Direct link to heading">#</a></h3><p>To write Integration tests, inherit the DynamoDbIntegrationTests class for some useful test setup.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dotnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class ExampleTest : DynamoDbIntegrationTests&lt;Startup&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  //... your tests here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will set up a web application factory so that you can make calls to endpoints, for example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dotnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var uri = new Uri($&quot;api/v1/residents/{personId}&quot;, UriKind. Relative);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var response = Client.GetAsync(uri);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It will set up a database connection and register it in a mock startup class. You can also use this connection in the test setup if you need to add anything to the database to test against. The base class also maintains the <strong> CleanupActions  </strong> collection of actions that can be used to remove any data that may have been added to the database during the test.</p><p><strong> Example </strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dotnet codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public async Task GetEntityByIdReturnsResponse().</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Create our test entity</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var entity = _fixture.Create&lt;Entity&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Add our test entity to the database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  await SetupTestData(entity).ConfigureAwait(false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Make the call to the API endpoint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var uri = new Uri($&quot;api/v1/entity/{entity.Id}&quot;, UriKind.Relative);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var response await Client.GetAsync(uri).ConfigureAwait(false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Check the reponse code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  response.StatusCode.Should().Be(HttpStatusCode. OK);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Get the response payload</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var responseContent = await response.Content.ReadAsStringAsync().ConfigureAwait(false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var apiEntity = JsonConvert.DeserializeObject&lt;Entity&gt;(responseContent);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Check it&#x27;s what we expected</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  apiEntity.Should(). BeEquivalentTo(entity);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">private async Task SetupTestData(Entity entity)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Save the entity in the database using the DynamoDbContext base class member</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  await DynamoDbContext.SaveAsync(entity.ToDatabase()).ConfigureAwait(false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Add a cleanup task to remove this entity from the database in the test tear down</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CleanupActions.Add(async () =&gt; await DynamoDbContext.DeleteAsync&lt;DatabaseEntity&gt;(entity.Id).ConfigureAwait(false):</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/API-Playbook/edit/master/docs/integration_tests.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/API-Playbook/mock_unit_tests"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Isolating Unit Tests</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/API-Playbook/aws_ecs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AWS / ECS with Fargate and when to use Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a><ul><li><a href="#video-tutorial" class="table-of-contents__link">Video Tutorial</a></li></ul></li><li><a href="#postgres" class="table-of-contents__link">Postgres</a></li><li><a href="#dynamodb" class="table-of-contents__link">DynamoDb</a><ul><li><a href="#database-connection" class="table-of-contents__link">Database connection</a></li><li><a href="#database-setup" class="table-of-contents__link">Database setup</a></li><li><a href="#writing-tests" class="table-of-contents__link">Writing tests</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/API-Playbook/styles.95e5aed4.js"></script>
<script src="/API-Playbook/runtime~main.1c0c8783.js"></script>
<script src="/API-Playbook/main.f4f132b0.js"></script>
<script src="/API-Playbook/1.df898764.js"></script>
<script src="/API-Playbook/2.94161a26.js"></script>
<script src="/API-Playbook/71.75b0a699.js"></script>
<script src="/API-Playbook/74.c8b6e964.js"></script>
<script src="/API-Playbook/935f2afb.2614505f.js"></script>
<script src="/API-Playbook/17896441.1e3aea75.js"></script>
<script src="/API-Playbook/33c4419d.e6ccc942.js"></script>
</body>
</html>