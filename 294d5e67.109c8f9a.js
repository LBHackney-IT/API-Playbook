(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{140:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return m}));var a=t(0),o=t.n(a);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=o.a.createContext({}),s=function(e){var n=o.a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},u=function(e){var n=s(e.components);return o.a.createElement(p.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},d=o.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,r=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(t),d=a,m=u["".concat(r,".").concat(d)]||u[d]||b[d]||i;return t?o.a.createElement(m,c(c({ref:n},p),{},{components:t})):o.a.createElement(m,c({ref:n},p))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=d;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var p=2;p<i;p++)r[p]=t[p];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},81:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return r})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return s}));var a=t(3),o=t(7),i=(t(0),t(140)),r={id:"multiple_docker_containers",title:"Composing Your Application With Multiple Docker Containers"},c={unversionedId:"multiple_docker_containers",id:"multiple_docker_containers",isDocsHomePage:!1,title:"Composing Your Application With Multiple Docker Containers",description:"Purpose",source:"@site/docs/multiple_docker_containers.md",slug:"/multiple_docker_containers",permalink:"/API-Playbook/multiple_docker_containers",editUrl:"https://github.com/LBHackney-IT/API-Playbook/edit/master/docs/multiple_docker_containers.md",version:"current",sidebar:"docs",previous:{title:"Lambda Functions Use and Good Practice",permalink:"/API-Playbook/lambda_best_practices"},next:{title:"Alerting",permalink:"/API-Playbook/alerting"}},l=[{value:"Purpose",id:"purpose",children:[]},{value:"Introduction",id:"introduction",children:[]},{value:"Video Tutorial",id:"video-tutorial",children:[]},{value:"Composing Your Application",id:"composing-your-application",children:[]},{value:"Running Your Composition",id:"running-your-composition",children:[]},{value:"Cleaning Up",id:"cleaning-up",children:[]}],p={toc:l};function s(e){var n=e.components,t=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"purpose"},"Purpose"),Object(i.b)("p",null,"The purpose of this document is to outline how and when best to orchestrate the creation and linking of multiple containers using docker-compose"),Object(i.b)("h2",{id:"introduction"},"Introduction"),Object(i.b)("p",null,"You may already be aware that Docker is used extensively within HackIt when building APIs and services. You may also already know how we would go about spinning up a container for an application."),Object(i.b)("p",null,"For many of our use cases, spinning up the application in a container by itself is not sufficient. The application may require access to other external resources such as a database or an API."),Object(i.b)("p",null,"In order to do this there needs to be a way to spin up multiple containers and make them accessible to each other."),Object(i.b)("h2",{id:"video-tutorial"},"Video Tutorial"),Object(i.b)("figure",{class:"video-container"},Object(i.b)("iframe",{width:"100%",src:"https://www.youtube.com/embed/Kz-tTwSePoI",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),Object(i.b)("h2",{id:"composing-your-application"},"Composing Your Application"),Object(i.b)("p",null,"When you have an application in a docker container you can simply run the command ",Object(i.b)("inlineCode",{parentName:"p"},"docker run [your-application]")," to get it up and running."),Object(i.b)("p",null,"However, by default this container won\u2019t be all you need to test an application.  It is likely that there would be additional resources, for example a database, that your application would need access to. If you have a database image available you can spin this up and link it to your application using docker-compose."),Object(i.b)("p",null,"In your container project you will need the ",Object(i.b)("inlineCode",{parentName:"p"},"Dockerfile")," for each container in your project. You will also need to have a ",Object(i.b)("inlineCode",{parentName:"p"},"docker-compose.yml")," file in your project where you will define all of the services that are required for your application."),Object(i.b)("p",null,"An example docker-compose file taken from our BaseAPI looks like the following:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-yaml"},'version: "3.2"\n\nservices:\n  base-api:\n    image: base-api\n    build:\n      context: BaseApi/\n      dockerfile: ./Dockerfile\n    ports:\n      - 3000:3000\n    environment:\n      - CONNECTION_STRING=[database connection string]\n    links:\n      - dev-database\n  dev-database:\n    env_file:\n      - database.env\n    image: postgres:12\n    volumes:\n      - ./database:/docker-entrypoint-initdb.d\n\n  base-api-test:\n    image: base-api-test\n    build:\n      context: .\n      dockerfile: BaseApi.Tests/Dockerfile\n    environment:\n      - DB_HOST=[database url]\n      - DB_PORT=[database port]\n      - DB_USERNAME=[database username]\n      - DB_PASSWORD=[database password]\n      - DB_DATABASE=[database name]\n    links:\n      - test-database\n\n  test-database:\n    image: test-database\n    build:\n      context: .\n      dockerfile: database/Dockerfile\n    ports:\n      -[mapped port eg 5444]:[container port eg 5432]\n    env_file:\n      - database.env\n')),Object(i.b)("p",null,"The following is a breakdown of the various aspects of the base api docker-compose file (you can visit this link for all of the available configuration items for version 3 of docker-compose):"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"}," Version: "),"  The version of the docker-compose format being used.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"}," Services: ")," These are the various containerised components of the application."),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"For example ",Object(i.b)("inlineCode",{parentName:"li"},"base-api")," is the section that describes the container that is created for the application itself while ",Object(i.b)("inlineCode",{parentName:"li"},"dev-database")," is the section that describes the container where the database will run.  "))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"}," Image: "),"  The name that Docker will give to the image when it is built (this could alternatively be the tag of the image if a build step is configured).")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"}," Build: ")," This provides the source  and context for the configuration items Docker needs to build the application image.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"}," Environment: "),"  Here you can specify any environment variables required for your application to run including database connection information."),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"This can also be supplied using environment variables specified in the env_file section."),Object(i.b)("li",{parentName:"ul"},"It is strongly advised not to include environment variables within the docker-compose file itself outside of your development environment."),Object(i.b)("li",{parentName:"ul"},"Instead, you can instruct Docker to get environment variables from the local environment where the container is being run."),Object(i.b)("li",{parentName:"ul"},"To supply a connection string from your local environment the following configuration can be used:",Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",{parentName:"pre",className:"language-yaml"},"environment: \n    - CONNECTION_STRING=$LOCAL_CONNECTION_STRING\n"))),Object(i.b)("li",{parentName:"ul"},"This will instruct Docker to look at your local environment for a  ",Object(i.b)("inlineCode",{parentName:"li"},"LOCAL_CONNECTION_STRING")," variable and supply that to the ",Object(i.b)("inlineCode",{parentName:"li"},"CONNECTION_STRING")," variable for the application."))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"}," Ports: ")," If you need to expose any ports outside the containerised environment you can specify them here with the container port being the port the application actually listens on in the container and the mapped port being the port you will use in your local environment.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("strong",{parentName:"p"}," Links: "),"  Any related service that the main application would connect to can be spun up in parallel using these links."))),Object(i.b)("h2",{id:"running-your-composition"},"Running Your Composition"),Object(i.b)("p",null,"You can spin up any individual service directly by calling ",Object(i.b)("inlineCode",{parentName:"p"},"docker-compose up [name of service]"),"."),Object(i.b)("p",null,"If the service is linked to another service via the ",Object(i.b)("inlineCode",{parentName:"p"},"links:")," section the linked service will also be spun up."),Object(i.b)("p",null,"For example when calling ",Object(i.b)("inlineCode",{parentName:"p"},"docker-compose up base-api"),", as this service has a link to the dev-database, the dev-database will also be spun up in a container along with the base api application. "),Object(i.b)("p",null,"If you need to manually supply environment variables when running a composition and do not want to add them to your system environment they can be prepended to the docker-compose command, for example:"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"CONNECTION_STRING=[a connection string] docker-compose up base-api")),Object(i.b)("h2",{id:"cleaning-up"},"Cleaning Up"),Object(i.b)("p",null,"It is important to periodically clean up your docker image cache using ",Object(i.b)("inlineCode",{parentName:"p"},"docker system prune")," or by clearing down unused images from the Docker dashboard."),Object(i.b)("p",null,"This will ensure that your computer doesn\u2019t grind to a halt from lack of resources."))}s.isMDXComponent=!0}}]);